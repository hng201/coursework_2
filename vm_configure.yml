- name: Configure Node VM
  hosts: azure
  user: azureuser
  become: yes

  vars:
    myResourceGroup: ansible
    myVM: ansible-node

  tasks:
  - name: Install Various Packages
    apt:
      update_cache: yes
      name: "{{ packages }}"
    vars:
      packages:
      - libssl-dev
      - libffi-dev
      - python-dev
      - python-pip

  - name: Install Ansible for Azure
    command: pip install ansible[azure]
  
  - stat:
     path: /home/azureuser/kubectl_node.sh
    register: result
  
  - name: Copy kubectl_node.sh to Node
    copy:
      src: ./kubectl_node.sh
      dest: /home/azureuser/kubectl_node.sh
    when: result.stat.exists == false

  - name: Set kubectl_node.sh permissions
    command: chmod +x /home/azureuser/kubectl_node.sh

  - name: Run kubectl installation script
    command: sudo /home/azureuser/kubectl_node.sh

  - stat:
     path: /home/azureuser/minikube_node.sh
    register: result1

  - name: Copy minikube_node.sh to Node
    copy:
      src: ./minikube_node.sh
      dest: /home/azureuser/minikube_node.sh
    when: result1.stat.exists == false

  - name: Set minikube_node.sh permissions
    command: chmod +x /home/azureuser/minikube_node.sh

  - name: Run minikube installation script
    command: sudo /home/azureuser/minikube_node.sh

  - stat:
      path: /home/azureuser/docker_node.sh
    register: result2

  - name: Copy docker_node.sh to Node
    copy:
      src: ./docker_node.sh
      dest: /home/azureuser/docker_node.sh
    when: result2.stat.exists == false

  - name: Set docker_node.sh permissions
    command: chmod +x /home/azureuser/docker_node.sh

  - name: Run Docker installation script
    command: sudo /home/azureuser/docker_node.sh

